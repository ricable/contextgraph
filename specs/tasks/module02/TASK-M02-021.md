# TASK-M02-021: Define CognitivePulse Struct

```xml
<task_spec id="TASK-M02-021" version="1.0">
<metadata>
  <title>Define CognitivePulse Struct</title>
  <status>blocked</status>
  <layer>surface</layer>
  <module>module-02</module>
  <sequence>21</sequence>
  <priority>critical</priority>
  <estimated_hours>2</estimated_hours>
  <implements>
    <item>REQ-CORE-007: CognitivePulse requirements</item>
    <item>TECH-CORE-002 Section 2.4: CognitivePulse specification</item>
  </implements>
  <depends_on>
    <task_ref>TASK-M02-019</task_ref>
    <task_ref>TASK-M02-020</task_ref>
  </depends_on>
  <estimated_complexity>medium</estimated_complexity>
</metadata>

<context>
The CognitivePulse struct represents the current cognitive state of the system, providing a snapshot of entropy, coherence, curiosity, confidence, and emotional state. This pulse is returned with every context injection response (~30 tokens) and guides agent behavior. The pulse is the primary mechanism for the system to communicate its cognitive state to agents.
</context>

<input_context_files>
  <file purpose="EmotionalState and SuggestedAction enums">crates/context-graph-core/src/pulse.rs</file>
  <file purpose="PRD reference for Cognitive Pulse">docs2/contextprd.md</file>
  <file purpose="Constitution for pulse cost">docs2/constitution.yaml</file>
</input_context_files>

<prerequisites>
  <check>TASK-M02-019 (EmotionalState) completed</check>
  <check>TASK-M02-020 (SuggestedAction) completed</check>
</prerequisites>

<scope>
  <in_scope>
    - CognitivePulse struct with 7 fields
    - entropy: f32 in [0, 1]
    - coherence: f32 in [0, 1]
    - curiosity_score: f32 in [0, 1]
    - confidence: f32 in [0, 1]
    - emotional_state: EmotionalState
    - suggested_action: SuggestedAction
    - timestamp: DateTime&lt;Utc&gt;
    - Serde Serialize/Deserialize
    - Clone, Debug, PartialEq derives
    - Doc comments explaining metric ranges
  </in_scope>
  <out_of_scope>
    - new() constructor (TASK-M02-022)
    - compute_suggested_action() method (TASK-M02-022)
    - update(), blend(), to_json() methods (TASK-M02-022)
    - Default trait implementation (TASK-M02-022)
  </out_of_scope>
</scope>

<definition_of_done>
  <signatures>
    <signature file="crates/context-graph-core/src/pulse.rs">
use chrono::{DateTime, Utc};

/// Represents the current cognitive state of the system.
///
/// The pulse is returned with every context injection (~30 tokens)
/// and guides agent behavior based on entropy/coherence levels.
///
/// # Metrics
/// - `entropy`: [0,1] - Measure of uncertainty/novelty in current context
/// - `coherence`: [0,1] - Measure of structural consistency
/// - `curiosity_score`: [0,1] - Drive to explore new information
/// - `confidence`: [0,1] - Certainty in current context quality
///
/// # Example Response
/// ```json
/// {"entropy": 0.3, "coherence": 0.8, "curiosity_score": 0.5,
///  "confidence": 0.7, "emotional_state": "focused",
///  "suggested_action": "ready", "timestamp": "2025-01-01T00:00:00Z"}
/// ```
#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct CognitivePulse {
    /// Entropy/novelty measure [0,1]. Higher = more uncertainty.
    pub entropy: f32,

    /// Coherence/consistency measure [0,1]. Higher = more structured.
    pub coherence: f32,

    /// Curiosity/exploration drive [0,1]. Higher = more exploratory.
    pub curiosity_score: f32,

    /// Confidence in context quality [0,1]. Higher = more certain.
    pub confidence: f32,

    /// Current emotional state affecting UTL calculations.
    pub emotional_state: EmotionalState,

    /// Recommended action based on current metrics.
    pub suggested_action: SuggestedAction,

    /// Timestamp of this pulse snapshot.
    pub timestamp: DateTime&lt;Utc&gt;,
}
    </signature>
  </signatures>

  <constraints>
    - All f32 metrics must be in [0, 1] range
    - timestamp must use chrono::DateTime&lt;Utc&gt;
    - Struct must serialize to approximately 30 tokens (per constitution)
    - Field order in struct should match JSON serialization order for consistency
  </constraints>

  <verification>
    - cargo build --package context-graph-core compiles without errors
    - cargo test --package context-graph-core pulse passes all tests
    - Serde round-trip preserves all fields
    - JSON serialization produces expected format
  </verification>
</definition_of_done>

<pseudo_code>
pulse.rs (additions):

use chrono::{DateTime, Utc};

// CognitivePulse struct with doc comments
// Seven fields representing cognitive state snapshot

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub struct CognitivePulse {
    pub entropy: f32,
    pub coherence: f32,
    pub curiosity_score: f32,
    pub confidence: f32,
    pub emotional_state: EmotionalState,
    pub suggested_action: SuggestedAction,
    pub timestamp: DateTime&lt;Utc&gt;,
}

#[cfg(test)]
mod cognitive_pulse_tests:
  test_struct_fields_accessible()
  test_serde_roundtrip()
  test_json_format()
  test_approximate_token_count()
</pseudo_code>

<files_to_create>
  <!-- No new files - additions to existing pulse.rs -->
</files_to_create>

<files_to_modify>
  <file path="crates/context-graph-core/src/pulse.rs">Add CognitivePulse struct</file>
  <file path="crates/context-graph-core/src/lib.rs">Add CognitivePulse to re-exports</file>
  <file path="crates/context-graph-core/Cargo.toml">Add chrono dependency if not present</file>
</files_to_modify>

<validation_criteria>
  <criterion>CognitivePulse struct compiles with all 7 fields</criterion>
  <criterion>Serde Serialize/Deserialize work correctly</criterion>
  <criterion>Clone, Debug, PartialEq traits implemented</criterion>
  <criterion>Doc comments explain metric ranges</criterion>
  <criterion>JSON output matches expected format</criterion>
</validation_criteria>

<test_commands>
  <command>cargo build --package context-graph-core</command>
  <command>cargo test --package context-graph-core cognitive_pulse -- --nocapture</command>
  <command>cargo clippy --package context-graph-core -- -D warnings</command>
</test_commands>
</task_spec>
```

## Implementation Notes

### Token Budget (~30 tokens)
Per the constitution, the pulse should cost approximately 30 tokens. Example JSON:
```json
{"entropy":0.3,"coherence":0.8,"curiosity_score":0.5,"confidence":0.7,"emotional_state":"focused","suggested_action":"ready","timestamp":"2025-01-01T00:00:00Z"}
```

### Metric Interpretation (Reference)
From the PRD:
- **entropy > 0.7**: High uncertainty, consider exploration or stabilization
- **coherence > 0.7**: Well-structured context, ready for action
- **coherence < 0.4**: Poorly structured, need clarification
- **curiosity_score > 0.7**: Strong drive to explore

### Integration Points
The CognitivePulse is:
1. Returned with `inject_context` responses
2. Available via `utl://current_session/pulse` resource
3. Used by `get_memetic_status` for dashboard

---

*Task ID: TASK-M02-021*
*Module: 02 - Core Infrastructure*
*Layer: Surface*
